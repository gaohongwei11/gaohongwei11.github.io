<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>从零搭建一个React项目 | 前端开发手册</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="前端开发手册，打造完善的知识体系">
    <link rel="preload" href="/assets/css/0.styles.34d67128.css" as="style"><link rel="preload" href="/assets/js/app.bb2a9879.js" as="script"><link rel="preload" href="/assets/js/2.7c6cafdd.js" as="script"><link rel="preload" href="/assets/js/5.fdded31a.js" as="script"><link rel="prefetch" href="/assets/js/10.dd439686.js"><link rel="prefetch" href="/assets/js/11.67a17777.js"><link rel="prefetch" href="/assets/js/12.06084239.js"><link rel="prefetch" href="/assets/js/13.a2b68210.js"><link rel="prefetch" href="/assets/js/14.8f26a79f.js"><link rel="prefetch" href="/assets/js/15.c7df6d85.js"><link rel="prefetch" href="/assets/js/16.a2875399.js"><link rel="prefetch" href="/assets/js/17.c496297c.js"><link rel="prefetch" href="/assets/js/18.3df49b3f.js"><link rel="prefetch" href="/assets/js/19.b4e91d39.js"><link rel="prefetch" href="/assets/js/3.a2ae1510.js"><link rel="prefetch" href="/assets/js/4.2c2befba.js"><link rel="prefetch" href="/assets/js/6.06a5455e.js"><link rel="prefetch" href="/assets/js/7.d7ae11ea.js"><link rel="prefetch" href="/assets/js/8.1754cb45.js"><link rel="prefetch" href="/assets/js/9.a0e27dca.js">
    <link rel="stylesheet" href="/assets/css/0.styles.34d67128.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端开发手册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Css" class="dropdown-title"><span class="title">Css</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Css/" class="nav-link">
  css文字
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码块" class="dropdown-title"><span class="title">代码块</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Utils/" class="nav-link">
  插件系列
</a></li><li class="dropdown-item"><!----> <a href="/Utils/image.html" class="nav-link">
  图片系列
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目搭建" class="dropdown-title"><span class="title">项目搭建</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/React/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  React
</a></li><li class="dropdown-item"><!----> <a href="/Vue/" class="nav-link">
  Vue
</a></li></ul></div></div><div class="nav-item"><a href="/Three.js/" class="nav-link">
  Three.js
</a></div> <a href="https://github.com/gaohongwei11" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Css" class="dropdown-title"><span class="title">Css</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Css/" class="nav-link">
  css文字
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码块" class="dropdown-title"><span class="title">代码块</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Utils/" class="nav-link">
  插件系列
</a></li><li class="dropdown-item"><!----> <a href="/Utils/image.html" class="nav-link">
  图片系列
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目搭建" class="dropdown-title"><span class="title">项目搭建</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/React/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  React
</a></li><li class="dropdown-item"><!----> <a href="/Vue/" class="nav-link">
  Vue
</a></li></ul></div></div><div class="nav-item"><a href="/Three.js/" class="nav-link">
  Three.js
</a></div> <a href="https://github.com/gaohongwei11" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>从零搭建一个React项目</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/React/#create-react-app" class="sidebar-link">create-react-app</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/React/#初始化" class="sidebar-link">初始化</a></li><li class="sidebar-sub-header"><a href="/React/#目录结构调整" class="sidebar-link">目录结构调整</a></li></ul></li><li><a href="/React/#引入-antd-mobile" class="sidebar-link">引入 antd-mobile</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/React/#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/React/#基本应用" class="sidebar-link">基本应用</a></li></ul></li><li><a href="/React/#使用-sass" class="sidebar-link">使用 Sass</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/React/#使用-fastclick" class="sidebar-link">使用 Fastclick</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/React/#vw适配" class="sidebar-link">vw适配</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/React/#安装-2" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/React/#配置" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/React/#vw兼容方案" class="sidebar-link">vw兼容方案</a></li></ul></li><li><a href="/React/#setupproxy" class="sidebar-link">setupProxy</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/React/#安装-http-proxy-middleware" class="sidebar-link">安装 http-proxy-middleware</a></li><li class="sidebar-sub-header"><a href="/React/#配置代理" class="sidebar-link">配置代理</a></li></ul></li><li><a href="/React/#api" class="sidebar-link">Api</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/React/#接口" class="sidebar-link">接口</a></li><li class="sidebar-sub-header"><a href="/React/#axios封装" class="sidebar-link">axios封装</a></li></ul></li><li><a href="/React/#使用-router-路由" class="sidebar-link">使用 Router(路由)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/React/#安装-3" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/React/#基本应用-2" class="sidebar-link">基本应用</a></li></ul></li><li><a href="/React/#使用-redux-状态管理" class="sidebar-link">使用 Redux(状态管理)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/React/#安装-4" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/React/#基本应用-3" class="sidebar-link">基本应用</a></li></ul></li><li><a href="/React/#最后" class="sidebar-link">最后 📌</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="从零搭建一个react项目"><a href="#从零搭建一个react项目" class="header-anchor">#</a> 从零搭建一个React项目</h1> <h2 id="create-react-app"><a href="#create-react-app" class="header-anchor">#</a> create-react-app</h2> <p><code>create-react-app</code> 是一个官方支持的创建 <code>React</code> 单页应用程序的方法。<br>
它提供了一个零配置的现代构建设置。</p> <h3 id="初始化"><a href="#初始化" class="header-anchor">#</a> 初始化</h3> <div class="language-sh extra-class"><pre class="language-sh"><code>npx create-react-app my-app  
<span class="token builtin class-name">cd</span> my-app  
<span class="token function">npm</span> start  
</code></pre></div><p><img src="/assets/img/screencast.c5721b6d.svg" alt=""></p> <h3 id="目录结构调整"><a href="#目录结构调整" class="header-anchor">#</a> 目录结构调整</h3> <p>下面是<code>create-react-app</code>生成的目录结构</p> <div class="language- extra-class"><pre class="language-text"><code>my-app
├── README.md
├── node_modules
├── package.json
├── .gitignore
├── public
│   ├── favicon.ico
│   ├── index.html
│   └── manifest.json
└── src
    ├── App.css
    ├── App.js
    ├── App.test.js
    ├── index.css
    ├── index.js
    ├── logo.svg
    └── serviceWorker.js
</code></pre></div><p>我们需要简单调整一下</p> <div class="language-js extra-class"><pre class="language-js"><code>my<span class="token operator">-</span>app
├── <span class="token constant">README</span><span class="token punctuation">.</span>md
├── node_modules
├── <span class="token keyword">package</span><span class="token punctuation">.</span>json
├── <span class="token punctuation">.</span>gitignore
├── <span class="token keyword">public</span>
│   ├── favicon<span class="token punctuation">.</span>ico
│   ├── index<span class="token punctuation">.</span>html
│   └── manifest<span class="token punctuation">.</span>json
└── src
    ├── assets <span class="token comment">// 资源</span>
    │    ├── style
    │    └── images
    ├── component <span class="token comment">// 组件</span>
    │    ├── header
    │    └── footer
    ├── pages  <span class="token comment">// 页面</span>
    │    ├── home
    │    │    ├── home<span class="token punctuation">.</span>jsx
    │    │    └── home<span class="token punctuation">.</span>scss
    │    ├── detail
    │    │    ├── detail<span class="token punctuation">.</span>jsx
    │    │    └── detail<span class="token punctuation">.</span>scss
    │    └── list
    │        ├── list<span class="token punctuation">.</span>jsx
    │        └── list<span class="token punctuation">.</span>scss
    ├── utils <span class="token comment">// 工具 </span>
    ├── index<span class="token punctuation">.</span>js
    └── serviceWorker<span class="token punctuation">.</span>js
</code></pre></div><h2 id="引入-antd-mobile"><a href="#引入-antd-mobile" class="header-anchor">#</a> 引入 antd-mobile</h2> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> antd-mobile --save
</code></pre></div><h3 id="基本应用"><a href="#基本应用" class="header-anchor">#</a> 基本应用</h3> <p>引入 <code>react-app-rewired</code> 并修改 <code>package.json</code> 里的启动配置。由于新的 <code>react-app-rewired@2.x</code> 版本的关系，你还需要安装 <code>customize-cra</code>。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> react-app-rewired customize-cra --save-dev
</code></pre></div><div class="language-json extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><br><div class="highlighted"> </div><br><br></div><pre class="language-json"><code><span class="token comment">/* package.json */</span>
<span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
-   <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts start&quot;</span><span class="token punctuation">,</span>
+   <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-app-rewired start&quot;</span><span class="token punctuation">,</span>
-   <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts build&quot;</span><span class="token punctuation">,</span>
+   <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-app-rewired build&quot;</span><span class="token punctuation">,</span>
-   <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts test --env=jsdom&quot;</span><span class="token punctuation">,</span>
+   <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-app-rewired test --env=jsdom&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后在项目根目录创建一个 config-overrides.js 用于修改默认配置。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">override</span><span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// do stuff with the webpack config...</span>
  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>使用 <code>babel-plugin-import</code>, <code>babel-plugin-import</code> 是一个用于按需加载组件代码和样式的 <code>babel</code> 插件（原理），现在我们尝试安装它并修改 <code>config-overrides.js</code> 文件。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> babel-plugin-import --save-dev
</code></pre></div><div class="language-js extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-js"><code><span class="token operator">+</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> override<span class="token punctuation">,</span> fixBabelImports <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'customize-cra'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">-</span> module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">override</span><span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">-</span>   <span class="token comment">// do stuff with the webpack config...</span>
<span class="token operator">-</span>   <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">+</span> module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">override</span><span class="token punctuation">(</span>
<span class="token operator">+</span>   <span class="token function">fixBabelImports</span><span class="token punctuation">(</span><span class="token string">'import'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>     libraryName<span class="token operator">:</span> <span class="token string">'antd-mobile'</span><span class="token punctuation">,</span>
<span class="token operator">+</span>     style<span class="token operator">:</span> <span class="token string">'css'</span><span class="token punctuation">,</span>
<span class="token operator">+</span>   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>引用方式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd-mobile'</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="使用-sass"><a href="#使用-sass" class="header-anchor">#</a> 使用 Sass</h2> <p>安装 <code>node-sass</code></p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> node-sass --save
<span class="token comment"># or</span>
<span class="token function">yarn</span> <span class="token function">add</span> node-sass
</code></pre></div><p>现在你可以将 <code>src/pages/home.css</code> 重命名为 <code>src/pages/home.scss</code></p> <h2 id="使用-fastclick"><a href="#使用-fastclick" class="header-anchor">#</a> 使用 Fastclick</h2> <p>移动设备上的浏览器默认会在用户点击屏幕大约延迟300毫秒后才会触发点击事件</p> <p>安装</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> fastclick --save
</code></pre></div><p>使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> FastClick <span class="token keyword">from</span> <span class="token string">'fastclick'</span><span class="token punctuation">;</span>

FastClick<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="vw适配"><a href="#vw适配" class="header-anchor">#</a> vw适配</h2> <p>参考手淘大漠老师的vw适配方案：<a href="https://www.w3cplus.com/mobile/vw-layout-in-vue.html" target="_blank" rel="noopener noreferrer">如何在Vue项目中使用vw实现移动端适配<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,做一个React版本的vw布局方案。</p> <p>对于Flexible或者说vw的布局，其原理不在这篇文章进行阐述。如果你想追踪其中的原委，强烈建议你阅读早前整理的文章《<a href="https://www.w3cplus.com/mobile/lib-flexible-for-html5-layout.html" target="_blank" rel="noopener noreferrer">使用Flexible实现手淘H5页面的终端适配<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>》和《<a href="https://www.w3cplus.com/css/vw-for-layout.html" target="_blank" rel="noopener noreferrer">再聊移动端页面的适配<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>》。</p> <h3 id="安装-2"><a href="#安装-2" class="header-anchor">#</a> 安装</h3> <ul><li><code>postcss-aspect-ratio-mini</code></li> <li><code>postcss-px-to-viewport</code></li> <li><code>postcss-write-svg</code></li> <li><code>postcss-cssnext</code></li> <li><code>postcss-viewport-units</code></li> <li><code>cssnano</code></li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> i postcss-aspect-ratio-mini postcss-px-to-viewport postcss-write-svg postcss-cssnext postcss-viewport-units cssnano --S   
</code></pre></div><p>在<code>cssnano</code>的配置中，使用了<code>preset: &quot;advanced&quot;</code>，所以我们需要另外安装：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> i cssnano-preset-advanced --save-dev  
</code></pre></div><h3 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h3> <p>还记得根目录下的 <code>config-overrides.js</code> 吗？，我们接着为vw适配添加配置：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> override<span class="token punctuation">,</span> fixBabelImports<span class="token punctuation">,</span> addLessLoader<span class="token punctuation">,</span> addWebpackAlias<span class="token punctuation">,</span> addPostcssPlugins <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'customize-cra'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">override</span><span class="token punctuation">(</span>
    <span class="token function">fixBabelImports</span><span class="token punctuation">(</span><span class="token string">'import'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        libraryName<span class="token operator">:</span> <span class="token string">'antd-mobile'</span><span class="token punctuation">,</span>
        style<span class="token operator">:</span> <span class="token string">'css'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">addLessLoader</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        javascriptEnabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        modifyVars<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">'@primary-color'</span><span class="token operator">:</span><span class="token string">'#1DA57A'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">addWebpackAlias</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token string">'@'</span><span class="token punctuation">]</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">addPostcssPlugins</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-import'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-url'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-flexbugs-fixes'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-preset-env'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            autoprefixer<span class="token operator">:</span> <span class="token punctuation">{</span>
                flexbox<span class="token operator">:</span> <span class="token string">'no-2009'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            stage<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-aspect-ratio-mini'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-px-to-viewport'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            viewportWidth<span class="token operator">:</span> <span class="token number">750</span><span class="token punctuation">,</span> <span class="token comment">// (Number) The width of the viewport.</span>
            viewportHeight<span class="token operator">:</span> <span class="token number">1334</span><span class="token punctuation">,</span> <span class="token comment">// (Number) The height of the viewport.</span>
            unitPrecision<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// (Number) The decimal numbers to allow the REM units to grow to.</span>
            viewportUnit<span class="token operator">:</span> <span class="token string">'vw'</span><span class="token punctuation">,</span> <span class="token comment">// (String) Expected units.</span>
            selectorBlackList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.ignore'</span><span class="token punctuation">,</span> <span class="token string">'.hairlines'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// (Array) The selectors to ignore and leave as px.</span>
            minPixelValue<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// (Number) Set the minimum pixel value to replace.</span>
            mediaQuery<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// (Boolean) Allow px to be converted in media queries.</span>
            exclude<span class="token operator">:</span> <span class="token regex">/(\/|\\)(node_modules)(\/|\\)/</span> <span class="token comment">// 排除node_modules文件中第三方css文件</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-write-svg'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            utf8<span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-viewport-units'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token function-variable function">filterRule</span><span class="token operator">:</span> <span class="token parameter">rule</span> <span class="token operator">=&gt;</span> rule<span class="token punctuation">.</span>nodes<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token operator">=&gt;</span> i<span class="token punctuation">.</span>prop <span class="token operator">===</span> <span class="token string">'content'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">// 过滤伪类content使用</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cssnano'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            preset<span class="token operator">:</span> <span class="token string">&quot;advanced&quot;</span><span class="token punctuation">,</span>
            autoprefixer<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token string">&quot;postcss-zindex&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="vw兼容方案"><a href="#vw兼容方案" class="header-anchor">#</a> vw兼容方案</h3> <p>使用<code>viewport</code>的<code>polyfill</code>：<a href="https://github.com/rodneyrehm/viewport-units-buggyfill" target="_blank" rel="noopener noreferrer">Viewport Units Buggyfill<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。使用<code>viewport-units-buggyfill</code>主要分以下几步走：</p> <p>第一步，引入JavaScript文件</p> <p><code>viewport-units-buggyfill</code>主要有两个JavaScript文件：<code>viewport-units-buggyfill.js</code>和<code>viewport-units-buggyfill.hacks.js</code>。你只需要在你的HTML文件中引入这两个文件。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//g.alicdn.com/fdilab/lib3rd/viewport-units-buggyfill/0.6.2/??viewport-units-buggyfill.hacks.min.js,viewport-units-buggyfill.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>第二步，在HTML文件中调用<code>viewport-units-buggyfill</code>，比如：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span>viewportUnitsBuggyfill<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            hacks<span class="token operator">:</span> window<span class="token punctuation">.</span>viewportUnitsBuggyfillHacks
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="或者"><a href="#或者" class="header-anchor">#</a> 或者</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> viewport-units-buggyfill
</code></pre></div><p>在<code>src/utils</code>工具文件夹下添加 <code>vw.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> hacks <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'viewport-units-buggyfill/viewport-units-buggyfill.hacks'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> viewportUnitsBuggyfill <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'viewport-units-buggyfill'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
viewportUnitsBuggyfill<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    hacks<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>然后，在<code>src/index.js</code>中引用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'./utils/vw'</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="setupproxy"><a href="#setupproxy" class="header-anchor">#</a> setupProxy</h2> <h3 id="安装-http-proxy-middleware"><a href="#安装-http-proxy-middleware" class="header-anchor">#</a> 安装 <code>http-proxy-middleware</code></h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> http-proxy-middleware
</code></pre></div><h3 id="配置代理"><a href="#配置代理" class="header-anchor">#</a> 配置代理</h3> <p>在<code>src</code>下建立<code>setupProxy.js</code>文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> createProxyMiddleware <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http-proxy-middleware'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
        <span class="token function">createProxyMiddleware</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            target<span class="token operator">:</span> <span class="token string">'https://www.v2ex.com'</span><span class="token punctuation">,</span>
            changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// needed for virtual hosted sites</span>
            pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'^/api'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="api"><a href="#api" class="header-anchor">#</a> Api</h2> <p><code>src</code>目录下新建：</p> <div class="language- extra-class"><pre class="language-text"><code>src
├── api
│   ├── api.js
│   └── server.js

</code></pre></div><h3 id="接口"><a href="#接口" class="header-anchor">#</a> 接口</h3> <p>集中管理api接口, <code>src/api/api.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Server <span class="token keyword">from</span> <span class="token string">'./server'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">API</span> <span class="token keyword">extends</span> <span class="token class-name">Server</span><span class="token punctuation">{</span>
  <span class="token comment">/**
   *  用途：最热主题
   *  @url https://www.v2ex.com/api/topics/hot.json
   *  返回status为1表示成功
   *  @method get
   *  @return {promise}
   */</span>
  <span class="token keyword">async</span> <span class="token function">getHot</span><span class="token punctuation">(</span><span class="token parameter">params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span><span class="token punctuation">{</span>
      <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">axios</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'/api/topics/hot.json'</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token operator">||</span> result<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> err <span class="token operator">=</span> <span class="token punctuation">{</span>
          tip<span class="token operator">:</span> <span class="token string">'获取最热主题失败'</span><span class="token punctuation">,</span>
          response<span class="token operator">:</span> result<span class="token punctuation">,</span>
          data<span class="token operator">:</span> params<span class="token punctuation">,</span>
          url<span class="token operator">:</span> <span class="token string">'//www.v2ex.com/api/topics/hot.json'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">API</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="axios封装"><a href="#axios封装" class="header-anchor">#</a> axios封装</h3> <p><code>src/api/server.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> envconfig <span class="token keyword">from</span> <span class="token string">'@/envconfig/envconfig'</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * 主要params参数
 * @params method {string} 方法名
 * @params url {string} 请求地址  例如：/login 配合baseURL组成完整请求地址
 * @params baseURL {string} 请求地址统一前缀 ***需要提前指定***  例如：http://cangdu.org
 * @params timeout {number} 请求超时时间 默认 30000
 * @params params {object}  get方式传参key值
 * @params headers {string} 指定请求头信息
 * @params withCredentials {boolean} 请求是否携带本地cookies信息默认开启
 * @params validateStatus {func} 默认判断请求成功的范围 200 - 300
 * @return {Promise}
 * 其他更多拓展参看axios文档后 自行拓展
 * 注意：params中的数据会覆盖method url 参数，所以如果指定了这2个参数则不需要在params中带入
*/</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Server</span> <span class="token punctuation">{</span>
  <span class="token function">axios</span><span class="token punctuation">(</span><span class="token parameter">method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> params <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> _option <span class="token operator">=</span> params<span class="token punctuation">;</span>
      _option <span class="token operator">=</span> <span class="token punctuation">{</span>
        method<span class="token punctuation">,</span>
        url<span class="token punctuation">,</span>
        baseURL<span class="token operator">:</span> envconfig<span class="token punctuation">.</span>baseURL<span class="token punctuation">,</span>
        timeout<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
        params<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        headers<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        withCredentials<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//是否携带cookies发起请求</span>
        <span class="token function-variable function">validateStatus</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">status</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token operator">...</span>params<span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
      axios<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>_option<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> res<span class="token punctuation">.</span>data <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">?</span> res<span class="token punctuation">.</span>data <span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><code>src/envconfig/envconfig.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 全局配置文件
 */</span>
<span class="token keyword">let</span> baseURL<span class="token punctuation">;</span> 
<span class="token keyword">let</span> imgUrl <span class="token operator">=</span> <span class="token string">'//www.v2ex.com'</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  baseURL <span class="token operator">=</span> <span class="token string">'/'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
  baseURL <span class="token operator">=</span> <span class="token string">'//www.v2ex.com'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>imgUrl<span class="token punctuation">,</span> baseURL<span class="token punctuation">}</span>

</code></pre></div><h2 id="使用-router-路由"><a href="#使用-router-路由" class="header-anchor">#</a> 使用 Router(路由)</h2> <h3 id="安装-3"><a href="#安装-3" class="header-anchor">#</a> 安装</h3> <p>安装 <code>react-router-dom</code></p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> react-router-dom
<span class="token comment"># or</span>
<span class="token function">yarn</span> <span class="token function">add</span> react-router-dom
</code></pre></div><h3 id="基本应用-2"><a href="#基本应用-2" class="header-anchor">#</a> 基本应用</h3> <p><code>src</code>目录下创建<code>router</code>文件夹，<code>router</code>文件夹下创建<code>index.js</code></p> <div class="language- extra-class"><pre class="language-text"><code>src
├── router
│   └── index.js

</code></pre></div><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// index.js</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserRouter<span class="token punctuation">,</span> Switch<span class="token punctuation">,</span> Route<span class="token punctuation">,</span> Redirect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> asyncComponent <span class="token keyword">from</span> <span class="token string">'@/utils/asyncComponent'</span><span class="token punctuation">;</span>

<span class="token comment">// import home from &quot;@/pages/home/home&quot;;</span>
<span class="token keyword">const</span> home <span class="token operator">=</span> <span class="token function">asyncComponent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;@/pages/home/home&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> detail <span class="token operator">=</span> <span class="token function">asyncComponent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;@/pages/detail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token function">asyncComponent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;@/pages/list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// react-router4 不再推荐将所有路由规则放在同一个地方集中式路由，子路由应该由父组件动态配置，组件在哪里匹配就在哪里渲染，更加灵活</span>
<span class="token keyword">class</span> <span class="token class-name">RouteConfig</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">BrowserRouter</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Switch</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/<span class="token punctuation">&quot;</span></span> <span class="token attr-name">exact</span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>home<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/list<span class="token punctuation">&quot;</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>list<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/detail<span class="token punctuation">&quot;</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>detail<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Redirect</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Switch</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">BrowserRouter</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> RouteConfig
</code></pre></div><p>这里有一个实现按需加载的工具 <code>asyncComponent.jsx</code></p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// asyncComponent.jsx</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">asyncComponent</span><span class="token punctuation">(</span><span class="token parameter">importComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">AsyncComponent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
        component<span class="token operator">:</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> component <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">importComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>component<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token constant">C</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>component<span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token constant">C</span> <span class="token operator">?</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">C</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">this</span><span class="token punctuation">.</span><span class="token attr-value">props</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> AsyncComponent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>添加到 <code>src/index.js</code></p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// src/index.js</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Route <span class="token keyword">from</span> <span class="token string">'./router/'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> FastClick <span class="token keyword">from</span> <span class="token string">'fastclick'</span><span class="token punctuation">;</span>

FastClick<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token parameter">Component</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Component</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">render</span><span class="token punctuation">(</span>Route<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Webpack Hot Module Replacement API</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">'./router/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span>Route<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// If you want your app to work offline and load faster, you can change</span>
<span class="token comment">// unregister() to register() below. Note this comes with some pitfalls.</span>
<span class="token comment">// Learn more about service workers: https://bit.ly/CRA-PWA</span>
serviceWorker<span class="token punctuation">.</span><span class="token function">unregister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="使用-redux-状态管理"><a href="#使用-redux-状态管理" class="header-anchor">#</a> 使用 Redux(状态管理)</h2> <p>Redux 是 JavaScript 状态容器，提供可预测化的状态管理。</p> <h3 id="安装-4"><a href="#安装-4" class="header-anchor">#</a> 安装</h3> <p>安装稳定版</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> --save redux 
</code></pre></div><p>多数情况下，你还需要使用 React 绑定库和开发者工具。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> --save react-redux  
<span class="token function">npm</span> <span class="token function">install</span> --save-dev redux-devtools  
</code></pre></div><h3 id="基本应用-3"><a href="#基本应用-3" class="header-anchor">#</a> 基本应用</h3> <p><code>src</code>目录下创建<code>store</code>文件夹，<code>store</code>文件夹下创建<code>store.js</code></p> <div class="language- extra-class"><pre class="language-text"><code>src
└── store
   ├── home
   │     ├── action.js
   │     ├── action-type.js
   │     └── reducer.js
   └── store.js

</code></pre></div><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// store.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>createStore<span class="token punctuation">,</span> combineReducers<span class="token punctuation">,</span> applyMiddleware<span class="token punctuation">,</span> compose<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> home <span class="token keyword">from</span> <span class="token string">'./home/reducer'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> production <span class="token keyword">from</span> <span class="token string">'./production/reducer'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> thunk <span class="token keyword">from</span> <span class="token string">'redux-thunk'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> composeEnhancers <span class="token operator">=</span>
  <span class="token keyword">typeof</span> window <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span>
  window<span class="token punctuation">.</span>__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ <span class="token operator">?</span>   
    window<span class="token punctuation">.</span><span class="token function">__REDUX_DEVTOOLS_EXTENSION_COMPOSE__</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// Specify extension’s options like name, actionsBlacklist, actionsCreators, serialize...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">:</span> compose<span class="token punctuation">;</span>

<span class="token keyword">const</span> enhancer <span class="token operator">=</span> <span class="token function">composeEnhancers</span><span class="token punctuation">(</span>
  <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// other store enhancers if any</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span>home<span class="token punctuation">,</span> <span class="token operator">...</span>production<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  enhancer
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>

</code></pre></div><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// action.js</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> home <span class="token keyword">from</span> <span class="token string">'./action-type'</span><span class="token punctuation">;</span>
<span class="token comment">// 保存列表数据</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">saveList</span> <span class="token operator">=</span> <span class="token parameter">list</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> home<span class="token punctuation">.</span><span class="token constant">SAVELIST</span><span class="token punctuation">,</span>
    list
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 请客数据</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">clearData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> home<span class="token punctuation">.</span><span class="token constant">CLEARDATA</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// action-type.js</span>
<span class="token comment">// 保存列表数据</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">SAVELIST</span> <span class="token operator">=</span> <span class="token string">'SAVELIST'</span><span class="token punctuation">;</span>
<span class="token comment">// 清空数据</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">CLEARDATA</span> <span class="token operator">=</span> <span class="token string">'CLEARDATA'</span><span class="token punctuation">;</span>

</code></pre></div><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// reducer.js</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> home <span class="token keyword">from</span> <span class="token string">'./action-type'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> defaultState <span class="token operator">=</span> <span class="token punctuation">{</span>
  list<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//主题列表</span>
<span class="token punctuation">}</span>
<span class="token comment">// 首页表单数据</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">list</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> defaultState <span class="token punctuation">,</span> action <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">case</span> home<span class="token punctuation">.</span><span class="token constant">SAVELIST</span><span class="token operator">:</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">{</span>list<span class="token operator">:</span> action<span class="token punctuation">.</span>list<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> home<span class="token punctuation">.</span><span class="token constant">CLEARDATA</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token operator">...</span>defaultState<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>添加到 <code>src/index.js</code></p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Route <span class="token keyword">from</span> <span class="token string">'./router/'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> FastClick <span class="token keyword">from</span> <span class="token string">'fastclick'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> serviceWorker <span class="token keyword">from</span> <span class="token string">'./serviceWorker'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppContainer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-hot-loader'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Provider<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'@/store/store'</span><span class="token punctuation">;</span>
<span class="token comment">// import './utils/setRem';</span>
<span class="token keyword">import</span> <span class="token string">'./utils/vw'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./style/base.css'</span><span class="token punctuation">;</span>

FastClick<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 监听state变化</span>
<span class="token comment">// store.subscribe(() =&gt; {</span>
<span class="token comment">//   console.log('store发生了变化');</span>
<span class="token comment">// });</span>

<span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token parameter">Component</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
    <span class="token comment">//绑定redux、热加载</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">store</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">AppContainer</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Component</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">AppContainer</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">render</span><span class="token punctuation">(</span>Route<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Webpack Hot Module Replacement API</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">'./router/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span>Route<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// If you want your app to work offline and load faster, you can change</span>
<span class="token comment">// unregister() to register() below. Note this comes with some pitfalls.</span>
<span class="token comment">// Learn more about service workers: https://bit.ly/CRA-PWA</span>
serviceWorker<span class="token punctuation">.</span><span class="token function">unregister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p><code>React-redux</code>使用，<code>connect</code></p> <div class="language-jsx extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token constant">API</span> <span class="token keyword">from</span> <span class="token string">'@/api/api'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> saveList<span class="token punctuation">,</span> clearData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/store/home/action'</span><span class="token punctuation">;</span>
<span class="token comment">// import PropTypes from 'prop-types';</span>
<span class="token keyword">import</span> <span class="token string">'./home.scss'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd-mobile'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Home</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    count<span class="token operator">:</span> <span class="token number">999</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'componentDidMount'</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getHot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">getHot</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">API</span><span class="token punctuation">.</span><span class="token function">getHot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>t<span class="token operator">:</span> <span class="token number">123456</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// console.log(result)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">saveList</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">goList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      pathname<span class="token operator">:</span> <span class="token string">'/list'</span><span class="token punctuation">,</span>
      query<span class="token operator">:</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      state<span class="token operator">:</span> <span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>home-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Home-</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span><span class="token comment">/* &lt;Button&gt;&lt;/Button&gt; */</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
  list<span class="token operator">:</span> state
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  saveList<span class="token punctuation">,</span> 
  clearData<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Home<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="最后"><a href="#最后" class="header-anchor">#</a> 最后 📌</h2> <p>🐶 开始快乐的写页面吧！</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/20/2021, 11:12:15 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.bb2a9879.js" defer></script><script src="/assets/js/2.7c6cafdd.js" defer></script><script src="/assets/js/5.fdded31a.js" defer></script>
  </body>
</html>
