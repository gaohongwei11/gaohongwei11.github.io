<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>three.js | 前端开发手册</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="前端开发手册，打造完善的知识体系">
    <link rel="preload" href="/assets/css/0.styles.34d67128.css" as="style"><link rel="preload" href="/assets/js/app.4fb8847e.js" as="script"><link rel="preload" href="/assets/js/2.09f6a602.js" as="script"><link rel="preload" href="/assets/js/5.5fa6add0.js" as="script"><link rel="prefetch" href="/assets/js/10.6fcc2647.js"><link rel="prefetch" href="/assets/js/11.7c64b010.js"><link rel="prefetch" href="/assets/js/12.af20145e.js"><link rel="prefetch" href="/assets/js/13.717c9748.js"><link rel="prefetch" href="/assets/js/14.ad2f7a37.js"><link rel="prefetch" href="/assets/js/15.d9d1f7fc.js"><link rel="prefetch" href="/assets/js/16.089c0192.js"><link rel="prefetch" href="/assets/js/17.7d6e2ea3.js"><link rel="prefetch" href="/assets/js/18.962e2940.js"><link rel="prefetch" href="/assets/js/19.db99be74.js"><link rel="prefetch" href="/assets/js/20.b278e17b.js"><link rel="prefetch" href="/assets/js/21.64b7812f.js"><link rel="prefetch" href="/assets/js/3.490c4bbd.js"><link rel="prefetch" href="/assets/js/4.b80e4382.js"><link rel="prefetch" href="/assets/js/6.84e1f37e.js"><link rel="prefetch" href="/assets/js/7.b00f5bc9.js"><link rel="prefetch" href="/assets/js/8.2fdb55f7.js"><link rel="prefetch" href="/assets/js/9.ae910ae2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.34d67128.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端开发手册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="H5坑位指南" class="dropdown-title"><span class="title">H5坑位指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/H5/" class="nav-link">
  H5坑位指南
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Css" class="dropdown-title"><span class="title">Css</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Css/" class="nav-link">
  css文字
</a></li></ul></div></div><div class="nav-item"><a href="/Vue/code.html" class="nav-link">
  Vue
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目搭建" class="dropdown-title"><span class="title">项目搭建</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/Vue/" class="nav-link">
  Vue
</a></li></ul></div></div><div class="nav-item"><a href="/Utils/" class="nav-link">
  常用插件
</a></div><div class="nav-item"><a href="/Three.js/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Three.js
</a></div> <a href="https://github.com/gaohongwei11" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="H5坑位指南" class="dropdown-title"><span class="title">H5坑位指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/H5/" class="nav-link">
  H5坑位指南
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Css" class="dropdown-title"><span class="title">Css</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Css/" class="nav-link">
  css文字
</a></li></ul></div></div><div class="nav-item"><a href="/Vue/code.html" class="nav-link">
  Vue
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目搭建" class="dropdown-title"><span class="title">项目搭建</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/Vue/" class="nav-link">
  Vue
</a></li></ul></div></div><div class="nav-item"><a href="/Utils/" class="nav-link">
  常用插件
</a></div><div class="nav-item"><a href="/Three.js/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Three.js
</a></div> <a href="https://github.com/gaohongwei11" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>three.js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Three.js/#three-js-介绍" class="sidebar-link">three.js 介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Three.js/#树状结构图" class="sidebar-link">树状结构图</a></li><li class="sidebar-sub-header"><a href="/Three.js/#基础demo" class="sidebar-link">基础demo</a></li></ul></li><li><a href="/Three.js/#scene" class="sidebar-link">Scene</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Three.js/#雾化效果" class="sidebar-link">雾化效果</a></li><li class="sidebar-sub-header"><a href="/Three.js/#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/Three.js/#全景贴图" class="sidebar-link">全景贴图</a></li></ul></li><li><a href="/Three.js/#renderer" class="sidebar-link">Renderer</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Three.js/#光源" class="sidebar-link">光源</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Three.js/#orbitcontrols" class="sidebar-link">OrbitControls</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Three.js/#加载3d模型" class="sidebar-link">加载3D模型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Three.js/#fbx格式示例" class="sidebar-link">FBX格式示例</a></li><li class="sidebar-sub-header"><a href="/Three.js/#模型动画" class="sidebar-link">模型动画</a></li><li class="sidebar-sub-header"><a href="/Three.js/#自动缩放" class="sidebar-link">自动缩放</a></li><li class="sidebar-sub-header"><a href="/Three.js/#自动居中" class="sidebar-link">自动居中</a></li><li class="sidebar-sub-header"><a href="/Three.js/#模型标注" class="sidebar-link">模型标注</a></li><li class="sidebar-sub-header"><a href="/Three.js/#模型阴影" class="sidebar-link">模型阴影</a></li><li class="sidebar-sub-header"><a href="/Three.js/#material（材质）" class="sidebar-link">Material（材质）</a></li><li class="sidebar-sub-header"><a href="/Three.js/#贴图-material-map" class="sidebar-link">贴图(material.map)</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="three-js"><a href="#three-js" class="header-anchor">#</a> three.js</h1> <h2 id="three-js-介绍"><a href="#three-js-介绍" class="header-anchor">#</a> three.js 介绍</h2> <p>threejs是一个让用户通过javascript入手进入搭建webgl项目的类库。
作为笔记，不做复制粘贴官方文档的蠢事，只记录使用过程中遇到的些许问题和实现功能的方法。</p> <h3 id="树状结构图"><a href="#树状结构图" class="header-anchor">#</a> 树状结构图</h3> <p>场景Scene、相机Camera、渲染器Renderer缺一不可。</p> <p><img src="/assets/img/structure.d3c943e5.jpg" alt=""></p> <h3 id="基础demo"><a href="#基础demo" class="header-anchor">#</a> 基础demo</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//初始化场景</span>
<span class="token keyword">let</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//初始化相机</span>
<span class="token keyword">let</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PerspectiveCamera</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//初始化渲染器</span>
<span class="token keyword">let</span> renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//创建几何体</span>
<span class="token keyword">let</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//初始化材质</span>
<span class="token keyword">let</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    color<span class="token operator">:</span> <span class="token number">0x00ff00</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//生成模型</span>
<span class="token keyword">let</span> cube <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//向场景添加已创建的几何体模型</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>cube<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//设置相机位置</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> <span class="token function-variable function">animate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 旋转  </span>
    cube<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>x <span class="token operator">+=</span> <span class="token number">0.01</span><span class="token punctuation">;</span>
    cube<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>y <span class="token operator">+=</span> <span class="token number">0.01</span><span class="token punctuation">;</span>
    <span class="token comment">//渲染</span>
    renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//执行 animate</span>
<span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="scene"><a href="#scene" class="header-anchor">#</a> Scene</h2> <h3 id="雾化效果"><a href="#雾化效果" class="header-anchor">#</a> 雾化效果</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//初始化场景</span>
<span class="token keyword">let</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//设置雾化效果</span>
<span class="token keyword">const</span> <span class="token constant">BACKGROUND_COLOR</span> <span class="token operator">=</span> <span class="token number">0xffffff</span><span class="token punctuation">;</span>
scene<span class="token punctuation">.</span>fog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Fog</span><span class="token punctuation">(</span><span class="token constant">BACKGROUND_COLOR</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a href="https://threejs.org/docs/index.html#api/zh/scenes/Fog" target="_blank" rel="noopener noreferrer">雾（Fog）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//初始化场景</span>
<span class="token keyword">const</span> <span class="token constant">BACKGROUND_COLOR</span> <span class="token operator">=</span> <span class="token number">0xffffff</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//1、纯色背景</span>
scene<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span><span class="token constant">BACKGROUND_COLOR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//2、图片背景</span>
<span class="token keyword">let</span> textureLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> textureEquirec <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./static/img/bg.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
textureEquirec<span class="token punctuation">.</span>mapping <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>EquirectangularReflectionMapping<span class="token punctuation">;</span>
textureEquirec<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>sRGBEncoding<span class="token punctuation">;</span>

scene<span class="token punctuation">.</span>background <span class="token operator">=</span> textureEquirec<span class="token punctuation">;</span>
</code></pre></div><h3 id="全景贴图"><a href="#全景贴图" class="header-anchor">#</a> 全景贴图</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//初始化场景</span>
<span class="token keyword">let</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//全景贴图</span>
<span class="token keyword">let</span> textureLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> textureEquirec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>CubeTextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">'./static/img/'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'virtuell_l2_px.jpg'</span><span class="token punctuation">,</span> <span class="token string">'virtuell_l2_nx.jpg'</span><span class="token punctuation">,</span> <span class="token string">'virtuell_l2_py.jpg'</span><span class="token punctuation">,</span> <span class="token string">'virtuell_l2_ny.jpg'</span><span class="token punctuation">,</span> <span class="token string">'virtuell_l2_pz.jpg'</span><span class="token punctuation">,</span> <span class="token string">'virtuell_l2_nz.jpg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
textureEquirec<span class="token punctuation">.</span>mapping <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>EquirectangularReflectionMapping<span class="token punctuation">;</span>
textureEquirec<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>sRGBEncoding<span class="token punctuation">;</span>

scene<span class="token punctuation">.</span>background <span class="token operator">=</span> textureEquirec<span class="token punctuation">;</span>
</code></pre></div><p><a href="https://threejs.org/examples/webgl_materials_envmaps.html" target="_blank" rel="noopener noreferrer">全景示例1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://www.zwetdesign.com/wp-content/themes/boiler-theme/realtime/room/#mobile" target="_blank" rel="noopener noreferrer">全景示例2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="renderer"><a href="#renderer" class="header-anchor">#</a> Renderer</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>WebGLRenderer</span><span class="token punctuation">(</span>
    animation<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    antialias<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// preserveDrawingBuffer: true, //是否保留缓直到手动清除或被覆盖</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
renderer<span class="token punctuation">.</span><span class="token function">setPixelRatio</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>devicePixelRatio<span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span> renderer<span class="token punctuation">.</span>domElement <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">preserveDrawingBuffer</p> <p>当需要实现一个截屏功能时（当前canvas），网上多数的解决方案是设置 <code>preserveDrawingBuffer：true</code> ，然后使用 <code>toDataURL()</code> 方法来实现截图。
这样设置会遇到低性能的安卓设备卡顿问题。</p> <p>解决方案：在截图前调用 <code>renderer.render(scene, camera)</code> 手动触发一次渲染。然后使用 <code>toDataURL()</code> 截图。</p></div> <p><a href="https://threejs.org/docs/index.html#api/zh/renderers/WebGLRenderer" target="_blank" rel="noopener noreferrer">WebGLRenderer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="光源"><a href="#光源" class="header-anchor">#</a> 光源</h2> <h4 id="ambientlight-环境光"><a href="#ambientlight-环境光" class="header-anchor">#</a> AmbientLight 环境光</h4> <p>环境光会均匀的照亮场景中的所有物体。</p> <ul><li>不支持阴影。</li></ul> <p><a href="https://threejs.org/docs/index.html#api/zh/lights/AmbientLight" target="_blank" rel="noopener noreferrer">AmbientLight<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="directionallight-平行光"><a href="#directionallight-平行光" class="header-anchor">#</a> DirectionalLight 平行光</h4> <p>平行光是沿着特定方向发射的光。这种光的表现像是无限远,从它发出的光线都是平行的。常常用平行光来模拟太阳光 的效果; 太阳足够远，因此我们可以认为太阳的位置是无限远，所以我们认为从太阳发出的光线也都是平行的。</p> <ul><li>可以投射阴影</li></ul> <p><a href="https://threejs.org/docs/index.html#api/zh/lights/DirectionalLight" target="_blank" rel="noopener noreferrer">DirectionalLight<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="hemispherelight-半球光"><a href="#hemispherelight-半球光" class="header-anchor">#</a> HemisphereLight 半球光</h4> <p>半球光直接放置于场景之上，光照颜色从天空光线颜色颜色渐变到地面光线颜色。</p> <ul><li>不支持阴影。</li></ul> <p><a href="https://threejs.org/docs/index.html#api/zh/lights/HemisphereLight" target="_blank" rel="noopener noreferrer">HemisphereLight<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="pointlight-点光源"><a href="#pointlight-点光源" class="header-anchor">#</a> PointLight 点光源</h4> <p>从一个点向各个方向发射的光源。一个常见的例子是模拟一个灯泡发出的光。</p> <ul><li>可以投射阴影</li></ul> <p><a href="https://threejs.org/docs/index.html#api/zh/lights/PointLight" target="_blank" rel="noopener noreferrer">PointLight<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="rectarealight-平面光"><a href="#rectarealight-平面光" class="header-anchor">#</a> RectAreaLight 平面光</h4> <p>平面光光源从一个矩形平面上均匀地发射光线。这种光源可以用来模拟像明亮的窗户或者条状灯光光源。</p> <ul><li>不支持阴影。</li> <li>只支持 <code>MeshStandardMaterial</code> 和 <code>MeshPhysicalMaterial</code> 两种材质。</li> <li>你必须在你的场景中加入 <code>RectAreaLightUniformsLib</code> ，并调用<code>init()</code>。</li></ul> <p><a href="https://threejs.org/docs/index.html#api/zh/lights/RectAreaLight" target="_blank" rel="noopener noreferrer">RectAreaLight<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="spotlight-聚光灯"><a href="#spotlight-聚光灯" class="header-anchor">#</a> SpotLight 聚光灯</h4> <p>光线从一个点沿一个方向射出，随着光线照射的变远，光线圆锥体的尺寸也逐渐增大。</p> <ul><li>可以投射阴影</li></ul> <p><a href="https://threejs.org/docs/index.html#api/zh/lights/SpotLight" target="_blank" rel="noopener noreferrer">SpotLight<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="orbitcontrols"><a href="#orbitcontrols" class="header-anchor">#</a> OrbitControls</h2> <p>Orbit controls（轨道控制器）可以使得相机围绕目标进行轨道运动。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> controls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>OrbitControls</span><span class="token punctuation">(</span>
    camera<span class="token punctuation">,</span>
    renderer<span class="token punctuation">.</span>domElement <span class="token comment">//默认body，设置控制范围renderer.domElement</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
controls<span class="token punctuation">.</span>minPolarAngle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
controls<span class="token punctuation">.</span>maxPolarAngle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">90</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

controls<span class="token punctuation">.</span>enableDamping <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">//阻尼 惯性</span>
controls<span class="token punctuation">.</span>dampingFactor <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span> <span class="token comment">//阻尼系数</span>
controls<span class="token punctuation">.</span>enablePan <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token comment">//controls.autoRotate = true;</span>
controls<span class="token punctuation">.</span>zoomSpeed <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
controls<span class="token punctuation">.</span>rotateSpeed <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>
controls<span class="token punctuation">.</span>autoRotateSpeed <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// required if controls.enableDamping or controls.autoRotate are set to true</span>
    controls<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a href="https://threejs.org/docs/index.html#examples/zh/controls/OrbitControls" target="_blank" rel="noopener noreferrer">OrbitControls<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="加载3d模型"><a href="#加载3d模型" class="header-anchor">#</a> 加载3D模型</h2> <p>目前，3D模型的格式有成千上万种可供选择，但每一种格式都具有不同的目的、用途以及复杂性。 虽然 three.js已经提供了多种导入工具， 但是选择正确的文件格式以及工作流程将可以节省很多时间，以及避免遭受很多挫折。某些格式难以使用，或者实时体验效率低下，或者目前尚未得到完全支持。</p> <h3 id="fbx格式示例"><a href="#fbx格式示例" class="header-anchor">#</a> FBX格式示例</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
    FBXLoader
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'three/examples/jsm/loaders/FBXLoader.js'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FBXLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>
    <span class="token string">'path/to/model.fbx'</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">mesh</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">xhr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 加载进度条</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>percent <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>loaded <span class="token operator">/</span> xhr<span class="token punctuation">.</span>total<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="模型动画"><a href="#模型动画" class="header-anchor">#</a> 模型动画</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//  AnimationMixer 动画混合器是用于场景中特定对象的动画的播放器。当场景中的多个对象独立动画时，每个对象都可以使用同一个动画混合器。</span>
mixer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AnimationMixer</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mesh<span class="token punctuation">.</span>animations<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//  clipAction 返回所传入的剪辑参数的AnimationAction, 根对象参数可选，默认值为混合器的默认根对象。</span>
    <span class="token keyword">let</span> action <span class="token operator">=</span> mixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span>mesh<span class="token punctuation">.</span>animations<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    action<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//  第一个参数可以是动画剪辑(AnimationClip)对象或者动画剪辑的名称。</span>
mixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span>mesh<span class="token punctuation">.</span>animations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="自动缩放"><a href="#自动缩放" class="header-anchor">#</a> 自动缩放</h3> <p>模型尺寸不统一的情况下，需要动态设置缩放系数来展示模型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 缩放系数计算</span>
<span class="token keyword">let</span> box <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Box3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
box<span class="token punctuation">.</span><span class="token function">expandByObject</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> length <span class="token operator">=</span> box<span class="token punctuation">.</span>max<span class="token punctuation">.</span>x <span class="token operator">-</span> box<span class="token punctuation">.</span>min<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
<span class="token keyword">let</span> width <span class="token operator">=</span> box<span class="token punctuation">.</span>max<span class="token punctuation">.</span>z <span class="token operator">-</span> box<span class="token punctuation">.</span>min<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
<span class="token keyword">let</span> height <span class="token operator">=</span> box<span class="token punctuation">.</span>max<span class="token punctuation">.</span>y <span class="token operator">-</span> box<span class="token punctuation">.</span>min<span class="token punctuation">.</span>y<span class="token punctuation">;</span>

<span class="token keyword">let</span> max<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">&gt;</span> width<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    max <span class="token operator">=</span> length<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    max <span class="token operator">=</span> width<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>max <span class="token operator">&lt;</span> height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    max <span class="token operator">=</span> height<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> zoom <span class="token operator">=</span> <span class="token number">6</span> <span class="token operator">/</span> max<span class="token punctuation">;</span>
mesh<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>zoom<span class="token punctuation">,</span> zoom<span class="token punctuation">,</span> zoom<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="自动居中"><a href="#自动居中" class="header-anchor">#</a> 自动居中</h3> <p>模型中心位置不统一的情况下，需要自动居中模型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 位置自动居中</span>
<span class="token keyword">let</span> box <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Box3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
box<span class="token punctuation">.</span><span class="token function">expandByObject</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> center <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
box<span class="token punctuation">.</span><span class="token function">getCenter</span><span class="token punctuation">(</span>center<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// mesh 中心坐标点偏移计算</span>
mesh<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">=</span> mesh<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">-</span> center<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
mesh<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> mesh<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">-</span> center<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
mesh<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">=</span> mesh<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">-</span> center<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
</code></pre></div><h3 id="模型标注"><a href="#模型标注" class="header-anchor">#</a> 模型标注</h3> <p><img src="/assets/img/size.259f7f36.jpg" alt=""></p> <p>当需要给3D模型添加尺寸标注时</p> <h4 id="画线"><a href="#画线" class="header-anchor">#</a> 画线</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 线材质</span>
<span class="token keyword">let</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>LineBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    color<span class="token operator">:</span> <span class="token number">0x0000ff</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 线段各个点array</span>
<span class="token keyword">let</span> points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
points<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
points<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
points<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//连点成线，生成线段</span>
<span class="token keyword">let</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BufferGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromPoints</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> line <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Line</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 添加至场景，渲染</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="文字"><a href="#文字" class="header-anchor">#</a> 文字</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//文字</span>
<span class="token keyword">let</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>FontLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>
        <span class="token string">'./static/fonts/helvetiker_regular.typeface.json'</span><span class="token punctuation">,</span>
        <span class="token parameter">font</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> txtMater <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                color<span class="token operator">:</span> <span class="token number">0xfb962e</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 宽文字</span>
            <span class="token keyword">let</span> textGeo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TextGeometry</span><span class="token punctuation">(</span>size<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token punctuation">{</span>
                font<span class="token operator">:</span> font<span class="token punctuation">,</span>
                size<span class="token operator">:</span> <span class="token number">70</span><span class="token punctuation">,</span>
                height<span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
                curveSegments<span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
                bevelEnabled<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                bevelThickness<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
                bevelSize<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
                bevelSegments<span class="token operator">:</span> <span class="token number">3</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            widthTextMesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>textGeo<span class="token punctuation">,</span> txtMater<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 在3D模型上添加文字，文字也需要同步进行缩放，zoom和模型缩放系数一样。</span>
            widthTextMesh<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>zoom<span class="token punctuation">,</span> zoom<span class="token punctuation">,</span> zoom<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// // 文字需要居中，因此计算文字模型的宽度，然后调整偏移文字模型position.x的值</span>
            <span class="token comment">// let textBox = new THREE.Box3();</span>
            <span class="token comment">// textBox.expandByObject(widthTextMesh);</span>
            <span class="token comment">// let textWidth = textBox.max.x - textBox.min.x</span>

            <span class="token comment">// widthTextMesh.position.set(-textWidth/2, box.max.y, 0);</span>

            scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>widthTextMesh<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div><h3 id="模型阴影"><a href="#模型阴影" class="header-anchor">#</a> 模型阴影</h3> <p>如果需要给模型添加阴影，首先渲染器开启阴影</p> <div class="language-js extra-class"><pre class="language-js"><code>renderer<span class="token punctuation">.</span>shadowMap<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre></div><p>还需要选择可以投射阴影的光源，并开启投影，这里以平行光为例</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> directionalLight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>DirectionalLight</span><span class="token punctuation">(</span> <span class="token number">0xffffff</span><span class="token punctuation">,</span> <span class="token number">0.5</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//开启投影</span>
directionalLight<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> directionalLight <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>添加接收阴影的平面</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Floor</span>
<span class="token keyword">let</span> floorGeometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PlaneGeometry</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> floorMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshPhongMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  color<span class="token operator">:</span> <span class="token number">0xeeeeee</span><span class="token punctuation">,</span>
  shininess<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
floor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>floorGeometry<span class="token punctuation">,</span> floorMaterial<span class="token punctuation">)</span><span class="token punctuation">;</span>
floor<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.5</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">;</span>
<span class="token comment">//接收阴影</span>
floor<span class="token punctuation">.</span>receiveShadow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre></div><p>模型开启投影</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//模型阴影</span>
mesh<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span>isMesh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    o<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    o<span class="token punctuation">.</span>receiveShadow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="material（材质）"><a href="#material（材质）" class="header-anchor">#</a> Material（材质）</h3> <p>three.js提供了多种材质，比如 <code>MeshBasicMaterial</code> 、 <code>MeshLambertMaterial</code> 、 <code>MeshPhongMaterial</code> 、 <code>MeshPhysicalMaterial</code> 等。这里以 <code>MeshPhysicalMaterial</code> 为例，</p> <div class="language-js extra-class"><pre class="language-js"><code>mesh<span class="token punctuation">.</span>material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshPhysicalMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    color<span class="token operator">:</span> <span class="token number">0xff0000</span><span class="token punctuation">,</span>
    <span class="token comment">// 材质像金属的程度. 非金属材料，如木材或石材，使用0.0，金属使用1.0，中间没有（通常）.</span>
    <span class="token comment">// 默认 0.5. 0.0到1.0之间的值可用于生锈的金属外观</span>
    metalness<span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token comment">// 材料的粗糙程度. 0.0表示平滑的镜面反射，1.0表示完全漫反射. 默认 0.5</span>
    roughness<span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token comment">// 反射程度, 从 0.0 到1.0.默认0.5.</span>
    reflectivity<span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><a href="https://threejs.org/docs/index.html#api/zh/materials/MeshPhysicalMaterial" target="_blank" rel="noopener noreferrer">MeshPhysicalMaterial<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="custom-block tip"><p class="custom-block-title">透明玻璃</p> <p>实现玻璃等透明的材质时，需要同时设置
<code>mesh.material.opacity = 0.12</code>，
<code>mesh.material.transparent = true</code></p></div> <h3 id="贴图-material-map"><a href="#贴图-material-map" class="header-anchor">#</a> 贴图(material.map)</h3> <p><code>.envMap</code>环境贴图、<code>.map</code>纹理贴图、<code>.normalMap</code>法线贴图、<code>.specularMap</code>高光贴图</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> textureLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 加载颜色纹理</span>
<span class="token keyword">let</span> texture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./static/img/color.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mesh<span class="token punctuation">.</span>material<span class="token punctuation">.</span>map <span class="token operator">=</span> texture<span class="token punctuation">;</span>

<span class="token comment">// 加载法线贴图，表面细节更丰富</span>
<span class="token keyword">let</span> textureNormal <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./static/img/normal.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mesh<span class="token punctuation">.</span>material<span class="token punctuation">.</span>normalMap <span class="token operator">=</span> textureNormal
<span class="token comment">// 设置深浅程度</span>
mesh<span class="token punctuation">.</span>material<span class="token punctuation">.</span>normalScale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">)</span>

<span class="token comment">// 设置高光贴图，一个网格模型不同的区域反射光线的能力不同</span>
<span class="token keyword">let</span> textureSpecular <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./static/img/Specular.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mesh<span class="token punctuation">.</span>material<span class="token punctuation">.</span>specularMap <span class="token operator">=</span> textureSpecular<span class="token punctuation">;</span>
mesh<span class="token punctuation">.</span>material<span class="token punctuation">.</span>specular<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0xffffff</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 高光反射颜色</span>
mesh<span class="token punctuation">.</span>material<span class="token punctuation">.</span>shininess <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token comment">// 高光高亮程度，默认30</span>

<span class="token comment">// 设置环境贴图，反射周围环境，渲染更逼真</span>
<span class="token keyword">let</span> textureCube <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>CubeTextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">'./static/img/'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'virtuell_l2_px.jpg'</span><span class="token punctuation">,</span> <span class="token string">'virtuell_l2_nx.jpg'</span><span class="token punctuation">,</span> <span class="token string">'virtuell_l2_py.jpg'</span><span class="token punctuation">,</span> <span class="token string">'virtuell_l2_ny.jpg'</span><span class="token punctuation">,</span> <span class="token string">'virtuell_l2_pz.jpg'</span><span class="token punctuation">,</span> <span class="token string">'virtuell_l2_nz.jpg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mesh<span class="token punctuation">.</span>material<span class="token punctuation">.</span>envMap <span class="token operator">=</span> textureCube<span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/20/2021, 11:12:15 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4fb8847e.js" defer></script><script src="/assets/js/2.09f6a602.js" defer></script><script src="/assets/js/5.5fa6add0.js" defer></script>
  </body>
</html>
